<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>è…¾å†²çš®å½±æˆ Â· æ•°æ®æ”¶é›†ï¼ˆæ¼”ç¤ºï¼‰</title>
  <style>
    :root{--bg:#0f172a;--panel:#0b1220;--muted:#9aa4b2;--txt:#e6edf3;--accent:#60a5fa;--good:#22c55e;--bad:#ef4444}
    *{box-sizing:border-box} body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,"PingFang SC","Microsoft YaHei",sans-serif;background:#0b1220;color:var(--txt)}
    .wrap{max-width:1080px;margin:32px auto;padding:0 16px}
    .card{background:linear-gradient(180deg,#0f172a,#0b1220);border:1px solid rgba(255,255,255,.06);border-radius:14px;padding:22px 22px 26px;box-shadow:inset 0 1px 0 rgba(255,255,255,.04)}
    h1{margin:0 0 12px;font-size:26px}
    .muted{color:var(--muted)}
    label{display:block;margin:18px 0 8px}
    input[type=text],select,input[type=number]{width:100%;padding:12px 14px;border-radius:10px;border:1px solid rgba(255,255,255,.12);background:#0b1220;color:var(--txt);outline:none}
    input[type=number]{appearance:textfield} input::-webkit-outer-spin-button,input::-webkit-inner-spin-button{appearance:none;margin:0}
    .row{display:grid;grid-template-columns:1fr;gap:14px}
    @media(min-width:640px){.row{grid-template-columns:1fr 1fr}}
    .btns{display:flex;gap:12px;flex-wrap:wrap;margin-top:18px}
    button{padding:11px 16px;border:1px solid rgba(255,255,255,.12);border-radius:12px;background:#0b1220;color:var(--txt);cursor:pointer}
    .primary{background:linear-gradient(180deg,#1e40af,#1d4ed8);border-color:#1d4ed8}
    .ghost{background:#0b1220}
    .ok{color:var(--good)} .err{color:var(--bad)}
    .status{margin-top:16px;padding:12px;border:1px dashed rgba(255,255,255,.18);border-radius:10px;min-height:52px;white-space:pre-wrap}
    code{background:#0b1220;border:1px solid rgba(255,255,255,.12);padding:2px 6px;border-radius:6px}
    .foot{margin-top:14px;color:var(--muted);font-size:14px}
    .inline{display:inline-flex;align-items:center;gap:6px}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <h1>è…¾å†²çš®å½±æˆ Â· æ•°æ®æ”¶é›†ï¼ˆæ¼”ç¤ºï¼‰</h1>
      <div class="muted">æ­¤é¡µå¯å•ç‹¬ä½¿ç”¨ï¼Œä¹Ÿå¯ä»¥åµŒåˆ°ä½ çš„å°æ¸¸æˆé‡Œã€‚ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®ä¼šæŠŠä¸€æ¡â€œé€šå…³è®°å½•â€å‘é€åˆ°åç«¯ã€‚</div>

      <div class="row">
        <div>
          <label>æ˜µç§°</label>
          <input id="name" type="text" placeholder="ä¾‹å¦‚ï¼šå°æ¢…" />
        </div>
        <div>
          <label>å¹´çº§</label>
          <select id="grade">
            <option>ä¸‰å¹´çº§</option><option>å››å¹´çº§</option><option selected>äº”å¹´çº§</option><option>å…­å¹´çº§</option>
          </select>
        </div>
      </div>

      <div class="row">
        <div>
          <label>ç­çº§</label>
          <input id="klass" type="text" placeholder="ä¾‹å¦‚ï¼šä¸‰ç­" />
        </div>
        <div>
          <label>é—¯å…³ç”¨æ—¶ï¼ˆç§’ï¼‰</label>
          <input id="timeSec" type="number" min="0" value="60" />
        </div>
      </div>

      <div class="row">
        <div>
          <label>ç¬¬3å…³æ­¥æ•°</label>
          <input id="l3" type="number" min="0" value="8" />
        </div>
        <div>
          <label>æ˜¯å¦è§‚çœ‹è§†é¢‘</label>
          <select id="vSeen">
            <option value="æ˜¯" selected>æ˜¯</option>
            <option value="å¦">å¦</option>
          </select>
        </div>
      </div>

      <div class="btns">
        <button class="primary" id="btnSend">å‘é€æµ‹è¯•æ•°æ®</button>
        <button class="ghost" id="btnDry">åªæµ‹è¯•é€šè·¯ï¼ˆä¸å…¥åº“ï¼‰</button>
        <button class="ghost" id="btnPing">è¿é€šæ€§æ£€æµ‹ï¼ˆ/pingï¼‰</button>
      </div>

      <div class="status" id="status">ç­‰å¾…æ“ä½œâ€¦</div>

      <div class="foot">
        <span class="inline">ğŸ”— å‰ç«¯è°ƒç”¨æ¥å£ï¼š<code id="apiHint"></code></span><br/>
        <span class="inline">ğŸ§© å¦‚è¦åµŒå…¥ä½ çš„æ¸¸æˆï¼šè°ƒç”¨ <code>window.Collect.send(payload)</code> å³å¯ï¼ˆæœ¬é¡µå·²æ³¨å…¥å…¨å±€å¯¹è±¡ï¼‰ã€‚</span>
      </div>
    </div>
  </div>

  <script src="./collect.js"></script>
  <script>
    // æ˜¾ç¤ºå½“å‰ API æ ¹åœ°å€
    document.getElementById('apiHint').textContent = window.__COLLECT_API__ || 'ï¼ˆæœªåˆå§‹åŒ–ï¼‰';

    const $ = (id)=>document.getElementById(id);
    const statusBox = $('status');

    function getPayload(){
      return {
        name: $('name').value.trim(),
        grade: $('grade').value,
        class: $('klass').value.trim(),
        time_sec: Number($('timeSec').value || 0),
        l3_moves: Number($('l3').value || 0),
        v_seen: $('vSeen').value,
        timestamp: new Date().toISOString()
      };
    }

    // å‘é€å¹¶å†™çŠ¶æ€
    async function sendAndReport(payload, dry=false){
      statusBox.textContent = 'æ­£åœ¨å‘é€â€¦';
      try{
        const res = await window.Collect.send(payload, {dry});
        statusBox.innerHTML =
          '<span class="ok">âœ” å·²å‘é€</span>\\n' +
          JSON.stringify(res, null, 2);
      }catch(err){
        statusBox.innerHTML =
          '<span class="err">âœ– å¤±è´¥</span>\\n' +
          (err && err.message ? err.message : String(err));
      }
    }

    $('btnSend').onclick = ()=>sendAndReport(getPayload(), false);
    $('btnDry').onclick  = ()=>sendAndReport(getPayload(), true);

    $('btnPing').onclick = async ()=>{
      statusBox.textContent = 'æ­£åœ¨è¯·æ±‚ /pingâ€¦';
      try{
        const res = await window.Collect.ping();
        statusBox.innerHTML = '<span class="ok">âœ” /ping OK</span>\\n' + JSON.stringify(res, null, 2);
      }catch(err){
        statusBox.innerHTML = '<span class="err">âœ– /ping å¤±è´¥</span>\\n' + (err?.message || String(err));
      }
    };
  </script>
</body>
</html>
